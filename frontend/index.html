<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirViewer: Sistema Inteligente de Calidad del Aire - Trujillo 2025</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
          rel="stylesheet" 
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
          crossorigin="anonymous">
    
    <link href="css/style.css" rel="stylesheet"> 

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <style>
        .module-content { padding-top: 30px; padding-bottom: 30px; }
        header { background-color: #0d6efd; color: white; padding: 15px 0; text-align: center; }
        nav a { color: white; text-decoration: none; padding: 10px 18px; margin: 0 5px; border-radius: 5px; transition: background-color 0.3s; }
        nav a.active { background-color: #054099; font-weight: bold; }
        .aqi-value { font-size: 4rem !important; }
    </style>
</head>
<body>

    <header>
        <div class="container-fluid">
            <h1>AirViewer: Sistema Inteligente de Calidad del Aire</h1>
            <nav class="mt-2">
                <a href="#" id="nav-dashboard" class="active">Monitoreo </a>
                <a href="#" id="nav-prediction">Predicci贸n ML </a> 
                <a href="#" id="nav-history">Hist贸rico y Evaluaci贸n </a>
            </nav>
        </div>
    </header>

    <div class="container-fluid">
        <section id="dashboard-module" class="module-content">
            <h2 class="mb-4 text-primary">Monitoreo en Tiempo Real - Trujillo</h2>
            
            <div class="row">
                <div class="col-lg-12 mb-4">
                    <div id="aqi-global-status" class="card text-white bg-success p-4 shadow">
                        <h3 class="card-title">ndice de Calidad del Aire (AQI)</h3>
                        <p class="fs-1 fw-bold aqi-value" id="val-aqi">--</p> 
                        <p class="fs-4 status-message" id="estado-aqi">Cargando...</p>
                        <small class="text-white-50">ltima actualizaci贸n: <span id="last-update-time">--</span></small>
                    </div>
                </div>
            </div>

            <div class="row mb-4" id="sensor-readings">
                <div class="col-md-3">
                    <div class="card p-3 shadow-sm">
                        <h5>PM2.5</h5>
                        <p class="fs-3 fw-bold"><span id="val-pm25">--</span> <small class="text-muted">碌g/m鲁</small></p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-3 shadow-sm">
                        <h5>NO2</h5>
                        <p class="fs-3 fw-bold"><span id="val-no2">--</span> <small class="text-muted">ppm</small></p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-3 shadow-sm">
                        <h5>CO</h5>
                        <p class="fs-3 fw-bold"><span id="val-co">--</span> <small class="text-muted">ppm</small></p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card p-3 shadow-sm">
                        <h5>PM10</h5>
                        <p class="fs-3 fw-bold"><span id="val-pm10">--</span> <small class="text-muted">碌g/m鲁</small></p>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-lg-6 mb-4">
                    <div class="card p-3 shadow">
                        <h5 class="card-title">Tendencia de AQI (ltimas 24h)</h5>
                        <canvas id="chart-24h"></canvas> 
                    </div>
                </div>

                <div class="col-lg-6 mb-4">
                    <div class="card p-3 shadow">
                        <h5 class="card-title">Ubicaci贸n del Sensor IoT</h5>
                        <div id="map-container" style="height: 300px; background-color: #f8f9fa;">
                            <p class="text-center p-5 text-muted">Cargando Mapa...</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="prediction-module" class="module-content" style="display: none;">
            <main class="prediction-container">
                <h2 class="mb-4 text-primary"> Predicci贸n de Calidad del Aire - Pr贸ximas 24 Horas</h2>
                
                <div class="row">
                    <div class="col-lg-8 mb-4">
                        <div class="card p-3 shadow">
                            <h3>AQI Predicho vs. Real</h3>
                            <canvas id="chart-prediction" style="max-height: 400px;"></canvas>
                            <small class="text-muted mt-2">L铆nea punteada: Predicci贸n ML. L铆nea continua: Datos Hist贸ricos.</small>
                        </div>
                    </div>
                    
                    <div class="col-lg-4 mb-4">
                        <div class="card bg-warning text-dark mb-3 shadow">
                            <div class="card-body">
                                <h4>Pico de Contaminaci贸n Predicho</h4>
                                <p class="fs-1 fw-bold" id="pred-aqi-peak">--</p>
                                <p>Ocurrir谩: <span id="pred-time">--</span></p>
                            </div>
                        </div>
                        <div class="card mb-3 shadow">
                            <div class="card-body">
                                <h4>Contaminante Dominante</h4>
                                <p class="fs-2 fw-bold" id="dominant-pollutant">--</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <hr>
                
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card p-3 shadow">
                            <h5 class="card-title">Contribuci贸n de Fuentes de Contaminaci贸n</h5>
                            <canvas id="chart-sources" style="max-height: 300px;"></canvas>
                            <p class="small-note text-muted mt-2">Modelo de Atribuci贸n para el periodo predicho.</p>
                        </div>
                    </div>

                    <div class="col-md-6 mb-4">
                        <div class="card p-3 shadow">
                            <h5 class="card-title">M茅tricas de Evaluaci贸n del Modelo</h5>
                            <div class="row g-2">
                                <div class="col-6">
                                    <div class="card bg-light p-2 text-center">
                                        <h6>RMSE (Ra铆z del Error Cuadr谩tico Medio)</h6>
                                        <p class="fs-4 fw-bold" id="metric-rmse">--</p>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="card bg-light p-2 text-center">
                                        <h6>R2 (Coeficiente de Determinaci贸n)</h6>
                                        <p class="fs-4 fw-bold" id="metric-r2">--</p>
                                    </div>
                                </div>
                                <div class="col-12 mt-3">
                                    <small class="text-muted">Modelo Activo: <span id="model-name">--</span> (ltimo entrenamiento: <span id="last-trained">--</span>)</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </section>

        <section id="history-module" class="module-content" style="display: none;">
            <h2 class="mb-4 text-primary"> Datos Hist贸ricos y An谩lisis Detallado</h2>
            
            <div class="row">
                <div class="col-lg-12">
                    <div class="card p-4 shadow">
                        <h5 class="card-title">Filtro y Exportaci贸n de Datos</h5>
                        <div class="row g-3 align-items-end">
                            <div class="col-md-3">
                                <label for="start-date" class="form-label">Fecha de Inicio:</label>
                                <input type="date" class="form-control" id="start-date">
                            </div>
                            <div class="col-md-3">
                                <label for="end-date" class="form-label">Fecha de Fin:</label>
                                <input type="date" class="form-control" id="end-date">
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-primary w-100" id="btn-search">Buscar Datos</button> 
                            </div>
                            <div class="col-md-3">
                                <button class="btn btn-success w-100" id="btn-download">Descargar CSV</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <section id="data-management-form" class="mt-5 mb-5">
    <h3 class="text-primary mb-3">Gesti贸n de Registros de Sensor (Simulaci贸n)</h3>
    <div class="card p-4 shadow-sm">
        <h6 class="card-title text-muted">A帽adir Nuevo Punto de Monitoreo</h6>
        <div class="row g-3">
            
            <div class="col-md-3">
                <label for="input-timestamp" class="form-label">Fecha/Hora</label>
                <input type="datetime-local" class="form-control" id="input-timestamp">
            </div>
            
            <div class="col-md-2">
                <label for="input-pm25" class="form-label">PM2.5 (ug/m3)</label>
                <input type="number" class="form-control" id="input-pm25" placeholder="Ej: 35.0">
            </div>
            <div class="col-md-2">
                <label for="input-pm10" class="form-label">PM10 (ug/m3)</label>
                <input type="number" class="form-control" id="input-pm10" placeholder="Ej: 55.0">
            </div>

            <div class="col-md-2 d-flex align-items-end">
                <button class="btn btn-primary w-100" id="btn-add-record">
                    <i class="fas fa-plus"></i> Agregar Registro
                </button>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button class="btn btn-danger w-100" id="btn-delete-last">
                    <i class="fas fa-trash"></i> Eliminar ltimo
                </button>
            </div>
        </div>
    </div>
</section>
            <div class="row mt-4">
                <div class="col-lg-12">
                    <div class="card p-4 shadow">
                        <h5 class="card-title">Tabla de Datos Hist贸ricos (Promedio Horario)</h5>
                        <div class="table-responsive">
                            <table class="table table-striped" id="history-table">
                                <thead>
                                    <tr>
                                        <th>Fecha/Hora</th>
                                        <th>AQI</th>
                                        <th>PM2.5</th>
                                        <th>PM10</th>
                                        <th>NO2</th>
                                        <th>CO</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td colspan="5" class="text-center">Seleccione un rango para cargar los datos.</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            
            <section id="thesis-indicators" class="mt-5">
                <h3 class="text-primary mb-3">Resultados de Indicadores</h3>
                <div class="row g-3">
                    <div class="col-md-3">
                        <div class="card p-3 shadow-sm">
                            <h6>TPA Alcance Concentraci贸n (ug/m鲁 en Horas)</h6>
                            <p class="fs-4 fw-bold" id="ind-tpa-alcance">-- Hrs</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card p-3 shadow-sm">
                            <h6>TPA Respuesta Alerta (Segundos)</h6>
                            <p class="fs-4 fw-bold" id="ind-tpa-respuesta">-- Seg</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card p-3 shadow-sm">
                            <h6>% Precisi贸n de Zona Cr铆tica (PPE)</h6>
                            <p class="fs-4 fw-bold" id="ind-ppe">-- %</p>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card p-3 shadow-sm">
                            <h6>% Registros Sobre ECA (PSC)</h6>
                            <p class="fs-4 fw-bold" id="ind-psc">-- %</p>
                        </div>
                    </div>
                </div>
            </section>
        </section>
    </div> 

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
            crossorigin="anonymous">
    </script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="js/app.js"></script>
</body>
</html>